#!/bin/bash

# V2X数据集下载脚本
# 下载到RT-DETR v2项目目录下

set -e

# 设置数据集目录（相对于rtdetrv2_pytorch根目录）
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
RTDETR_ROOT="$(dirname "$SCRIPT_DIR")"
DATASET_DIR="$RTDETR_ROOT/datasets"

echo "=== V2X数据集下载脚本 ==="
echo "RT-DETR根目录: $RTDETR_ROOT"
echo "数据集目录: $DATASET_DIR"

# 创建目录结构
mkdir -p "$DATASET_DIR/RCooper"
mkdir -p "$DATASET_DIR/DAIR-V2X"
mkdir -p "$DATASET_DIR/processed/language_annotations"
mkdir -p "$DATASET_DIR/processed/expert_data"
mkdir -p "$DATASET_DIR/processed/splits"

echo ""
echo "=== 目录结构已创建 ==="
echo "RCooper目录: $DATASET_DIR/RCooper"
echo "DAIR-V2X目录: $DATASET_DIR/DAIR-V2X"
echo "处理后数据目录: $DATASET_DIR/processed"
echo ""

echo "=== 1. 下载RCooper数据集 ==="
echo "请按照以下步骤下载RCooper数据集："
echo ""
echo "步骤1: 访问GitHub仓库"
echo "  https://github.com/AIR-THU/DAIR-RCooper"
echo ""
echo "步骤2: 查看论文获取下载链接"
echo "  https://arxiv.org/abs/2403.10145"
echo ""
echo "步骤3: 下载数据到以下目录"
echo "  $DATASET_DIR/RCooper/"
echo ""
echo "预期目录结构："
echo "  RCooper/"
echo "  ├── rsu/          # 路侧单元数据"
echo "  ├── vehicle/      # 车载数据"
echo "  ├── annotations/  # 标注文件"
echo "  └── calibration/  # 标定信息"
echo ""

echo "=== 2. 下载DAIR-V2X数据集 ==="
echo "请按照以下步骤下载DAIR-V2X数据集："
echo ""
echo "方式1 - 使用OpenDataLab:"
echo "  pip install openxlab"
echo "  openxlab dataset get --dataset-repo DAIR-V2X/DAIR-V2X"
echo ""
echo "方式2 - 访问官网:"
echo "  官网: https://thudair.baai.ac.cn/"
echo "  OpenDataLab: https://opendatalab.com/DAIR-V2X"
echo ""
echo "步骤3: 下载数据到以下目录"
echo "  $DATASET_DIR/DAIR-V2X/"
echo ""
echo "预期目录结构："
echo "  DAIR-V2X/"
echo "  ├── infrastructure-side/  # 路侧数据"
echo "  ├── vehicle-side/         # 车载数据"
echo "  ├── co-operative/         # 协同数据"
echo "  └── annotations/          # 标注文件"
echo ""

echo "=== 3. 验证下载 ==="
echo "下载完成后，请运行以下命令验证："
echo ""
echo "  # 检查RCooper数据集"
echo "  ls -la $DATASET_DIR/RCooper/"
echo ""
echo "  # 检查DAIR-V2X数据集"
echo "  ls -la $DATASET_DIR/DAIR-V2X/"
echo ""

echo "=== 4. 下一步操作 ==="
echo "数据集下载完成后，请执行："
echo ""
echo "  1. 运行数据预处理脚本"
echo "     python scripts/preprocess_datasets.py"
echo ""
echo "  2. 生成语言指令标注"
echo "     python scripts/generate_language_annotations.py"
echo ""
echo "  3. 开始MoE模型训练"
echo "     python tools/train.py -c configs/rtdetrv2/rtdetrv2_r50vd_moe_6x_coco.yml"
echo ""

echo "=== 注意事项 ==="
echo "1. 数据集较大，请确保有足够的存储空间"
echo "2. 下载可能需要较长时间，请保持网络稳定"
echo "3. 请遵守数据集的使用许可协议"
echo "4. 仅用于学术研究目的"
echo ""

echo "脚本执行完成！请按照上述说明手动下载数据集。"
